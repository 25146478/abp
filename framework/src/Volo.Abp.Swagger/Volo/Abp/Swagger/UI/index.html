<!-- HTML for static distribution bundle build -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>%(DocumentTitle)</title>
    <link rel="stylesheet" type="text/css" href="./swagger-ui.css">
    <link rel="icon" type="image/png" href="./favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="./favicon-16x16.png" sizes="16x16" />
    <style>
        html {
            box-sizing: border-box;
            overflow: -moz-scrollbars-vertical;
            overflow-y: scroll;
        }

        *,
        *:before,
        *:after {
            box-sizing: inherit;
        }

        body {
            margin: 0;
            background: #fafafa;
        }
    </style>
    %(HeadContent)
</head>

<body>
    <div id="swagger-ui"></div>

    <!-- Workaround for https://github.com/swagger-api/swagger-editor/issues/1371 -->
    <script>
        if (window.navigator.userAgent.indexOf("Edge") > -1) {
            console.log("Removing native Edge fetch in favor of swagger-ui's polyfill")
            window.fetch = undefined;
        }
    </script>

    <script src="./swagger-ui-bundle.js"></script>
    <script src="./swagger-ui-standalone-preset.js"></script>
    <script>
        var abp = abp || {};

        (function () {

            /* Application paths *****************************************/

            // Current application root path (including virtual directory if exists).
            abp.appPath = abp.appPath || '/';

            /* AUTHORIZATION **********************************************/
            // Implements Authorization API that simplifies usage of authorization scripts generated by Abp.

            abp.auth = abp.auth || {};

            abp.auth.tokenCookieName = 'Abp.AuthToken';
            abp.auth.tokenTypeCookieName = 'Abp.AuthTokenType';
            abp.auth.tokenHeaderName = 'Authorization';

            abp.auth.setTokenType = function (type, expireDate) {
                abp.utils.setCookieValue(abp.auth.tokenTypeCookieName, type, expireDate, abp.appPath);
            };

            abp.auth.getTokenType = function() {
                return abp.utils.getCookieValue(abp.auth.tokenTypeCookieName);
            };

            abp.auth.setToken = function (authToken, expireDate) {
                abp.utils.setCookieValue(abp.auth.tokenCookieName, authToken, expireDate, abp.appPath);
            };

            abp.auth.getToken = function () {
                return abp.utils.getCookieValue(abp.auth.tokenCookieName);
            }

            abp.auth.clearToken = function () {
                abp.auth.setToken();
            }

            /* UTILS ***************************************************/

            abp.utils = abp.utils || {};

            /**
            * Sets a cookie value for given key.
            * This is a simple implementation created to be used by ABP.
            * Please use a complete cookie library if you need.
            * @param {string} key
            * @param {string} value
            * @param {Date} expireDate (optional). If not specified the cookie will expire at the end of session.
            * @param {string} path (optional)
            */
            abp.utils.setCookieValue = function (key, value, expireDate, path) {
                var cookieValue = encodeURIComponent(key) + '=';

                if (value) {
                    cookieValue = cookieValue + encodeURIComponent(value);
                }

                if (expireDate) {
                    cookieValue = cookieValue + "; expires=" + expireDate.toUTCString();
                }

                if (path) {
                    cookieValue = cookieValue + "; path=" + path;
                }

                document.cookie = cookieValue;
            };

            /**
            * Gets a cookie with given key.
            * This is a simple implementation created to be used by ABP.
            * Please use a complete cookie library if you need.
            * @param {string} key
            * @returns {string} Cookie value or null
            */
            abp.utils.getCookieValue = function (key) {
                var equalities = document.cookie.split('; ');
                for (var i = 0; i < equalities.length; i++) {
                    if (!equalities[i]) {
                        continue;
                    }

                    var splitted = equalities[i].split('=');
                    if (splitted.length != 2) {
                        continue;
                    }

                    if (decodeURIComponent(splitted[0]) === key) {
                        return decodeURIComponent(splitted[1] || '');
                    }
                }

                return null;
            };

            /**
            * Deletes cookie for given key.
            * This is a simple implementation created to be used by ABP.
            * Please use a complete cookie library if you need.
            * @param {string} key
            * @param {string} path (optional)
            */
            abp.utils.deleteCookie = function (key, path) {
                var cookieValue = encodeURIComponent(key) + '=';

                cookieValue = cookieValue + "; expires=" + (new Date(new Date().getTime() - 86400000)).toUTCString();

                if (path) {
                    cookieValue = cookieValue + "; path=" + path;
                }

                document.cookie = cookieValue;
            }

            /* SECURITY ***************************************/
            abp.security = abp.security || {};
            abp.security.antiForgery = abp.security.antiForgery || {};

            abp.security.antiForgery.tokenCookieName = 'XSRF-TOKEN';
            abp.security.antiForgery.tokenHeaderName = 'X-XSRF-TOKEN';

            abp.security.antiForgery.getToken = function () {
                return abp.utils.getCookieValue(abp.security.antiForgery.tokenCookieName);
            };

            /* Swagger */
            abp.swagger = abp.swagger || {};

            function loginUserInternal(tenantId, configObject, callback) {
                var usernameOrEmailAddress = document.getElementById('userName').value;
                if (!usernameOrEmailAddress) {
                    alert('Username or Email Address is required, please try with a valid value !');
                    return false;
                }

                var password = document.getElementById('password').value;
                if (!password) {
                    alert('Password is required, please try with a valid value !');
                    return false;
                }

                var xhr = new XMLHttpRequest();

                xhr.onreadystatechange = function () {
                    if (xhr.readyState === XMLHttpRequest.DONE) {
                        var responseJson = JSON.parse(xhr.responseText);
                        if (xhr.status === 200) {
                            var expireDate = new Date(Date.now() + (responseJson.expires_in * 1000));
                            abp.auth.setToken(responseJson.access_token, expireDate);
                            abp.auth.setTokenType(responseJson.token_type, expireDate);
                            callback();
                        } else {
                            alert(responseJson.error + "\n" + responseJson.error_description);
                        }
                    }
                };

                xhr.open('POST', configObject.Authority + '/connect/token', true);
                if (tenantId !== null) {
                    xhr.setRequestHeader(configObject.TenantKey, tenantId);
                }

                var data = new FormData();
                data.append("client_id", configObject.SwaggerClientId);
                data.append("client_secret", configObject.SwaggerClientSecret);
                data.append("grant_type", "password");
                data.append("scope", configObject.SwaggerScope);
                data.append("username", usernameOrEmailAddress);
                data.append("password", password);
                xhr.send(data);
            };

            abp.swagger.login = function (configObject, callback) {
                //Get TenantId first
                var tenantId = document.getElementById('tenantId').value;

                if (configObject.MultiTenancyIsEnabled && tenantId) {
                    loginUserInternal(tenantId, configObject, callback); // Login for tenant
                } else {
                    loginUserInternal(null, configObject, callback); // Login for host
                }
            };

            abp.swagger.logout = function () {
                abp.auth.clearToken();
            }

            abp.swagger.closeAuthDialog = function () {
                if (document.getElementById('abp-auth-dialog')) {
                    document.getElementsByClassName("swagger-ui")[1].removeChild(document.getElementById('abp-auth-dialog'));
                }
            };

            abp.swagger.openAuthDialog = function (configObject, loginCallback) {
                abp.swagger.closeAuthDialog();

                var abpAuthDialog = document.createElement('div');
                abpAuthDialog.className = 'dialog-ux';
                abpAuthDialog.id = 'abp-auth-dialog';

                document.getElementsByClassName("swagger-ui")[1].appendChild(abpAuthDialog);

                // -- backdrop-ux
                var backdropUx = document.createElement('div');
                backdropUx.className = 'backdrop-ux';
                abpAuthDialog.appendChild(backdropUx);

                // -- modal-ux
                var modalUx = document.createElement('div');
                modalUx.className = 'modal-ux';
                abpAuthDialog.appendChild(modalUx);

                // -- -- modal-dialog-ux
                var modalDialogUx = document.createElement('div');
                modalDialogUx.className = 'modal-dialog-ux';
                modalUx.appendChild(modalDialogUx);

                // -- -- -- modal-ux-inner
                var modalUxInner = document.createElement('div');
                modalUxInner.className = 'modal-ux-inner';
                modalDialogUx.appendChild(modalUxInner);

                // -- -- -- -- modal-ux-header
                var modalUxHeader = document.createElement('div');
                modalUxHeader.className = 'modal-ux-header';
                modalUxInner.appendChild(modalUxHeader);

                var modalHeader = document.createElement('h3');
                modalHeader.innerText = 'Authorize';
                modalUxHeader.appendChild(modalHeader);

                // -- -- -- -- modal-ux-content
                var modalUxContent = document.createElement('div');
                modalUxContent.className = 'modal-ux-content';
                modalUxInner.appendChild(modalUxContent);

                modalUxContent.onkeydown = function (e) {
                    if (e.keyCode === 13) {
                        //try to login when user presses enter on authorize modal
                        abp.swagger.login(configObject, loginCallback);
                    }
                };

                //Inputs
                if (configObject.MultiTenancyIsEnabled) {
                    createInput(modalUxContent, 'tenantId', 'Tenant Id');
                }
                createInput(modalUxContent, 'userName', 'Username or email address');
                createInput(modalUxContent, 'password', 'Password', 'password');

                //Buttons
                var authBtnWrapper = document.createElement('div');
                authBtnWrapper.className = 'auth-btn-wrapper';
                modalUxContent.appendChild(authBtnWrapper);

                //Authorize button
                var authorizeButton = document.createElement('button');
                authorizeButton.className = 'btn modal-btn auth authorize button';
                authorizeButton.innerText = 'Login';
                authorizeButton.style.marginRight = '10px';
                authorizeButton.onclick = function () {
                    abp.swagger.login(configObject, loginCallback);
                };
                authBtnWrapper.appendChild(authorizeButton);

                //Close button
                var closeButton = document.createElement('button');
                closeButton.className = 'btn modal-btn auth btn-done button';
                closeButton.innerText = 'Close';
                closeButton.onclick = abp.swagger.closeAuthDialog;
                authBtnWrapper.appendChild(closeButton);
            };

            function createInput(container, id, title, type) {
                var wrapper = document.createElement('div');
                wrapper.className = 'wrapper';
                container.appendChild(wrapper);

                var label = document.createElement('label');
                label.innerText = title;
                wrapper.appendChild(label);

                var section = document.createElement('section');
                section.className = 'block-tablet col-10-tablet block-desktop col-10-desktop';
                wrapper.appendChild(section);

                var input = document.createElement('input');
                input.id = id;
                input.type = type ? type : 'text';
                input.style.width = '100%';

                section.appendChild(input);
            };

        })();
    </script>
    <script>
        window.onload = function () {
            var configObject = JSON.parse('%(ConfigObject)');
            var oauthConfigObject = JSON.parse('%(OAuthConfigObject)');

            // Apply mandatory parameters
            configObject.dom_id = "#swagger-ui";
            configObject.presets = [SwaggerUIBundle.presets.apis, SwaggerUIStandalonePreset];
            configObject.layout = "StandaloneLayout";
            configObject.requestInterceptor = function (request) {
                var token = abp.auth.getToken();
                if (token) {
                    request.headers.Authorization = token ? abp.auth.getTokenType() + " " + token : null;
                }
                var antiForgeryToken = abp.security.antiForgery.getToken();
                if (antiForgeryToken) {
                    request.headers[abp.security.antiForgery.tokenHeaderName] = antiForgeryToken;
                }
                return request;
            };

            // If oauth2RedirectUrl isn't specified, use the built-in default
            if (!configObject.hasOwnProperty("oauth2RedirectUrl"))
                configObject.oauth2RedirectUrl = window.location.href.replace("index.html", "oauth2-redirect.html").split('#')[0];


            function getAuthorizeButtonText() {
                return abp.auth.getToken() ? 'Logout' : 'Authorize';
            }
            function getAuthorizeButtonCssClass() {
                return abp.auth.getToken() ? 'cancel' : 'authorize';
            }

            configObject.plugins = [
                function (system) {
                    return {
                        components: {
                            authorizeBtn: function () {
                                return system.React.createElement("button",
                                    {
                                        id: "authorize",
                                        className: "btn " + getAuthorizeButtonCssClass(),
                                        style: {
                                            lineHeight: "normal"
                                        },
                                        onClick: function () {
                                            if (abp.auth.getToken()) {
                                                abp.swagger.logout();
                                                location.reload();
                                            } else {
                                                abp.swagger.openAuthDialog(configObject, function () {
                                                    location.reload();
                                                });
                                            }
                                        }
                                    },
                                    getAuthorizeButtonText());
                            }
                        }
                    }
                }
            ];

            // Begin Swagger UI call region

            const ui = SwaggerUIBundle(configObject);

            ui.initOAuth(oauthConfigObject);

            // End Swagger UI call region

            window.ui = ui
        }
    </script>
</body>
</html>